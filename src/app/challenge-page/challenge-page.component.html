<!-- Challenge header -->
@if (challenge; as ch) {
  <section class="challenge-hero rounded-3 p-4 mb-4 position-relative overflow-hidden">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
      <div>
        <h1 class="m-0 fw-bold text-white">{{ ch.title }}</h1>

        @if (ch.challengeType == ChallengeType.DISTANCE) {
          <span class="badge bg-light text-dark mt-2">Distance Challenge</span>
        } @else {
          <span class="badge bg-light text-dark mt-2">Challenge</span>
        }
      </div>

      <!-- Quick stats -->
      <div class="d-flex gap-3">
        @if (ch.challengeType == ChallengeType.DISTANCE) {
          <div class="stat-card text-end">
            <div class="stat-label">Target Distance</div>
            <div class="stat-value">250 km</div>
          </div>
        }
        <div class="stat-card text-end">
          <div class="stat-label">Participants</div>
          <div class="stat-value">{{ ch.users.length }}</div>
        </div>
        <div class="stat-card text-end">
          <div class="stat-label">Sessions Logged</div>
          <div class="stat-value">â€”</div> <!-- plug real total when ready -->
        </div>
      </div>
    </div>

    <!-- subtle decorative glow -->
    <div class="hero-glow"></div>
  </section>
}

<!-- Participants -->
<div class="d-flex align-items-center justify-content-between mb-2">
  <h2 class="mb-0">Participants</h2>
  <div class="text-muted small">Sorted by session count</div>
</div>

<div class="table-responsive shadow-sm rounded-3">
  <table class="table table-striped table-hover align-middle mb-0">
    <thead class="table-light position-sticky top-0">
    <tr>
      <th scope="col" class="text-muted">#</th>
      <th scope="col">Hard Charger</th>
      <th scope="col">Branch</th>
      @if (challenge; as ch) {
        @if (ch.challengeType == ChallengeType.DISTANCE) {
          <th scope="col">Sum of Distance</th>
        }
      }
      <th scope="col">Session Count</th>
      <th scope="col">Avg Distance (m)</th>
      <th scope="col">Avg Time</th>
    </tr>
    </thead>

    <tbody>
      @if (challenge; as ch) {
        @for (user of ch.users; track user.publicId; let i = $index) {
          <tr>
            <th scope="row" class="text-muted">{{ i + 1 }}</th>
            <td class="d-flex align-items-center gap-2">
              <div class="avatar-circle" aria-hidden="true">
                {{ (user.firstName[0]) + (user.lastName[0]) }}
              </div>
              <div class="d-flex flex-column">
                <span class="fw-semibold">
                  {{ user.firstName + ' ' + user.lastName }}
                </span>
              </div>
            </td>
            <td>
              <span class="badge rounded-pill bg-secondary-subtle text-secondary-emphasis">
                {{ user.branch }}
              </span>
            </td>

            <!-- replace placeholders with your real data -->
            @if (ch.challengeType == ChallengeType.DISTANCE) {
              <td>100</td>
            }
            <td>5</td>
            <td>1,000</td>
            <td>00:45:00</td>
          </tr>
        }
      }
    </tbody>
  </table>
</div>


<div>
  <h2>Activity</h2>
  <table class="table table-striped table-hover">
    <thead>
    <tr>
      <th scope="col">Participant</th>
      <th scope="col">Start Time</th>
      <th scope="col">End Time</th>
      <th scope="col">Distance</th>
    </tr>
    </thead>
    <tbody>
      @if (exercises; as ex) {
        @for (exercise of ex; track exercise.id) {
          <tr>
            <td>{{ exercise.firstName + " " + exercise.lastName }}</td>
            <td>{{ exercise.startTime }}</td>
            <td>{{ exercise.endTime }}</td>
            <td contenteditable="true">{{ exercise.distance }}</td>

          </tr>
        }
      }
    <td>
    </tbody>
  </table>
  <form #exerciseForm="ngForm" (ngSubmit)="logExercise(exerciseForm)">
    <!-- Add Exercise button -->
    <button type="button" class="btn btn-primary my-3" (click)="showForm.set(true)">
      Add Exercise
    </button>

    <!-- Inline form -->
    @if (showForm()) {
      <form #exerciseForm="ngForm" (ngSubmit)="addExercise(exerciseForm)" class="border rounded p-3 mb-3">

        <div ngModelGroup="times" appDateRangeValidator>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Start Time</label>
              <input class="form-control" type="datetime-local" name="startTime" ngModel required>
            </div>

            <div class="col-md-4">
              <label class="form-label">End Time</label>
              <input class="form-control" type="datetime-local" name="endTime" ngModel required #endTime='ngModel'>


            @if (exerciseForm.controls['times'].errors?.['dateRange']) {
              <p class="date-validation-error">End date must be greater than start date</p>
            }
          </div>

          <div class="col-md-3">
            <label class="form-label">Distance (m)</label>
            <input class="form-control" type="number" name="distance" ngModel min="0" step="1" required>
          </div>
        </div>
          <div class="col-md-9">
            <label class="form-label">Notes</label>
            <input class="form-control" type="text" name="notes" ngModel>
          </div>
        </div>

        <div class="mt-3 d-flex gap-2">
          <button type="submit" class="btn btn-success">Save</button>
          <button type="button" class="btn btn-outline-secondary" (click)="showForm.set(false)">Cancel</button>
        </div>
      </form>
    }

  </form>

</div>
